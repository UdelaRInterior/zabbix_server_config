---

zabbix_server_config_become_on_localhost: false

zabbix_server_config_remove_apache_default_vhost: no

### API Login
zabbix_server_install_zabbix_api_pkg: true
zabbix_server_config_url: "https://{{ invertory_hostname }}"
zabbix_server_config_api_user: Admin
zabbix_server_config_api_pass: zabbix
zabbix_server_config_validate_certs: false


### Templates
zabbix_server_config_custom_templates_src: zabbix_custom_templates
zabbix_server_config_custom_templates_xml:
  - "{{ zabbix_server_config_custom_templates_src }}/zbx_exports_templates.xml"


### Mediatypes
zabbix_server_config_alertscript_path: /usr/lib/zabbix/alertscripts/

zabbix_server_config_custom_mediatypes:
  - name: Telegram
    type: script
    status: enabled
    script_src: telegram.sh.j2      # Path in local project
    script_name: telegram.sh
    script_params:
      - '{ALERT.SENDTO}'
      - '{ALERT.SUBJECT}'
      - '{ALERT.MESSAGE}'
    state: present


### Actions
################################################

zabbix_server_config_actions_default_subject: "Problem: {EVENT.NAME}"
zabbix_server_config_actions_default_message: "Problem started at {EVENT.TIME} on {EVENT.DATE} \n
                                              Problem name: {EVENT.NAME} \n
                                              Host: {HOST.NAME} \n
                                              Severity: {EVENT.SEVERITY} \n
                                              \n
                                              Original problem ID: {EVENT.ID} \n
                                              {TRIGGER.URL} \n
                                              \n
                                              Item Graphic: [{ITEM.ID1}]"

zabbix_server_config_actions_recovery_default_subject: "Resolved: {EVENT.NAME}"
zabbix_server_config_actions_recovery_default_message: "Problem has been resolved at {EVENT.RECOVERY.TIME} on {EVENT.RECOVERY.DATE} \n
                                                        Problem name: {EVENT.NAME} \n
                                                        Host: {HOST.NAME} \n
                                                        Severity: {TRIGGER.SEVERITY} \n
                                                        \n
                                                        Original problem ID: {EVENT.ID} \n
                                                        {TRIGGER.URL}\n
                                                        \n
                                                        Item Graphic: [{ITEM.ID1}]"

zabbix_server_config_custom_actions:
  - name: Send alerts via Telegram
    event_source: trigger
    state: present
    status: enabled
    esc_period: 60
    default_subject: "{{ zabbix_server_config_actions_default_subject }}"
    default_message: "{{ zabbix_server_config_actions_default_message }}"
    recovery_default_subject: "{{ zabbix_server_config_actions_recovery_default_subject }}"
    recovery_default_message: "{{ zabbix_server_config_actions_recovery_default_message }}"
    conditions:
      - type: trigger_severity
        operator: '>='
        value: Average
    operations:
      - type: send_message
        media_type: Telegram
        send_to_users:
          - telegram-bot
    recovery_operations:
      - type: send_message
        media_type: Telegram
        send_to_users:
          - telegram-bot


## For included example: mediatype script telegram.sh.j2
zabbix_server_config_telegram_username: 'telegram-bot'
zabbix_server_config_telegram_password: ''
zabbix_server_config_telegram_usergroup: "ReadOnly-telegram"
zabbix_server_config_telegram_bot_token: ''
##





